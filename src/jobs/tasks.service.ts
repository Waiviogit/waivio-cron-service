import { Injectable, Logger } from '@nestjs/common';
import { RedisService } from 'nestjs-redis';
import { Cron } from '@nestjs/schedule';
import * as moment from 'moment';
import * as _ from 'lodash';
import { PostsService } from '../post/post.service';
import {
  REDIS_EXPIRE_CLIENT, REDIS_KEY_CHILDREN_UPDATE, REDIS_KEY_VOTE_UPDATES, VOTE_FIELDS,
} from '../common/constants';
import {
  HIVE_ENGINE_TOKENS,
  REDIS_EXPIRE_CLIENT,
  REDIS_KEY_VOTE_UPDATES,
  HIVE_ENGINE_TOKEN_PRICE,
  REDIS_KEY_CHILDREN_UPDATE,
  REDIS_KEY_DISTRIBUTE_HIVE_ENGINE_REWARD,

  REDIS_KEY_REWARDED_AUTHORS,
} from '../common/constants';
import { HiveMindService } from '../hiveApi/hive-mind.service';
import { UserService } from '../user/user.service';
import { HiveEngineService } from '../hiveApi/hive-engine.service';

const users = [
  'serialfiller',
  'fujoshi94',
  'beyondhorizonmm',
  'nubra11',
  'tunkem1',
  'mima2606',
  'lecumberre',
  'goldcoin',
  'sarix',
  'digitalis',
  'ikeror',
  'hemma7',
  'lisfabian',
  'mawit07',
  'naythan',
  'mozzie5',
  'deanliu',
  'asterkame',
  'evahe',
  'teknon',
  'honeysaver',
  'grapthar',
  'annepink',
  'katiefreespirit',
  'cryptoyzzy',
  'hispaplus',
  'lozio71',
  'lapacodo',
  'sweetest',
  'musicmeister',
  'faraon71',
  'karypenarreta',
  'mattsanthonyit',
  'dswigle',
  'milezofplay',
  'akukamaruzzaman',
  'hafiz34',
  'harpreetjanda',
  'edcraft',
  'makhinoo',
  'htwegyi',
  'franvenezuela',
  'devpress',
  'steemrepair',
  'hafis',
  'alizmarpaola',
  'byercatire',
  'aung.kyaw.htet1',
  'iammufasa',
  'vaino-rami',
  'awesomegames007',
  'eii',
  'violetmed',
  'bala41288',
  'azwar.ipank',
  'opick',
  'kork75',
  'heidy17',
  'lowjab1',
  'aksurevm89',
  'repayme4568',
  'winelay',
  'elianaicgomes',
  'jazzy07',
  'master-lamps',
  'sucal',
  'cryptosharon',
  'joecariac0',
  'monsterbuster',
  'josepf2048',
  'cesarc',
  'dbooster',
  'arcoiris',
  'johnsdowie',
  'maddogmike',
  'catharsis',
  'miguelpeliculas',
  'hexagono6',
  'mati14',
  'donjaun',
  'rtonline',
  'cmplxty',
  'starthilfe',
  'danshak',
  'wynella',
  'madushanka',
  'eliezerfloyd',
  'leedsunited',
  'dgalan',
  'icyblitz',
  'atyh',
  'rocksg',
  'nayromero',
  'sheshe12',
  'maykk',
  'kenechukwu97',
  'victoradebiyiart',
  'jatinhota',
  'cyclope',
  'brian.rrr',
  'joeylim',
  'williams-owb',
  'motherhood',
  'byebyehamburgers',
  'yetaras',
  'hirundo',
  'animal-shelter',
  'justinparke',
  'galberto',
  'tegoshei',
  'pedrovivaz',
  'davidesimoncini',
  'sportstalkupvote',
  'alucar55',
  'supu',
  'razack-pulo',
  'anacristinasilva',
  'carlossteele',
  'marcosmilano71',
  'netizen01',
  'samminator',
  'cielitorojo',
  'gungunkrishu',
  'drax',
  'palabreador',
  'fieryfootprints',
  'walarhein',
  'city-bounter',
  'mari83',
  'spliddash',
  'veronicamartinc',
  'teesart',
  'shortshots',
  'failingforwards',
  'senstless',
  'ebingo',
  'travelgirl',
  'ong.aye.myat.mon',
  'ary21',
  'thegoliath',
  'hjrrodriguez',
  'elturimiquire',
  'misterlangdon',
  'alvarezjhon1',
  'anny05',
  'bennywb56',
  'firayumni',
  'maungthan',
  'emeka002',
  'twicejoy',
  'amirhayat572',
  'varunpinto',
  'luisestaba23',
  'stefanovah',
  'theguru.photos',
  'onespringday',
  'mary29',
  'iyanpol12',
  'bettyleo',
  'yoursensei',
  'lifeskills-tv',
  'saikaungzawthant',
  'jungch98',
  'harbeex',
  'daveks',
  'adi.pisces',
  'ptaku',
  'ismaelrd04',
  'marius19',
  'adribarrios',
  'primalamusica',
  'princekham',
  'erikahfit',
  'nextgen622',
  'chesatochi',
  'zanphoneaung',
  'bimpcy',
  'mili2801',
  'readthisplease',
  'guillerobla',
  'yayan',
  'mlrequena78',
  'alebrijes',
  'ykretz.sports',
  'xoxois',
  'adinapoli',
  'decentropia',
  'twicejoy2',
  'makeitreal95',
  'obsesija',
  'promiseonyi01',
  'afridany1',
  'ayopeju',
  'ervin-lemark',
  'leoneil',
  'yuza',
  'kavii',
  'anikearn',
  'dayna199019',
  'arcange-es',
  'happyfrog420-new',
  'kristal24',
  'dbuzz',
  'femcy-willy',
  'r1s2g3',
  'shariarahammad',
  'sreypov',
  'flordecar26',
  'aceh-media',
  'helyorsini',
  'maoyagi',
  'ezerledezma',
  'esperosh1ve',
  'juancar347',
  'itchyfeetdonica',
  'sugarelys',
  'delcarmat',
  'rafalforeigner',
  'zenai',
  'archimax72',
  'parissousa',
  'amcrypto',
  'tin.aung.soe',
  'sapphirecrypto',
  'tobetada',
  'brunonacif',
  'alexanderodulfo',
  'chronocrypto',
  'norat23',
  'onwugbenuvictor',
  'hiveclick',
  'kramaric.goat',
  'tere.alv',
  'mk992039',
  'gregorior',
  'ultratrain',
  'silvertop',
  'odanmedina',
  'lukeisalive',
  'angymusic',
  'alovely088',
  'kubak',
  'nilarwin',
  'davideribo',
  'kgakakillerg',
  'ozohu',
  'sarunya',
  'ddrfr33k',
  'perkysleen',
  'abbak7',
  'hive-142502',
  'sketch.and.jam',
  'tumppa-queen',
  'josediccus',
  'ange.nkuru',
  'barski',
  'pvmihalache',
  'dedhien',
  'faraicelebr8',
  'arcange',
  'corvoatano',
  'shiftrox',
  'yousaf-sports',
  'usmanart',
  'mellys',
  'benedict08',
  'iamsaray',
  'dkid14',
  'mirz',
  'vikbuddy',
  'dadapizza',
  'hooiyewlim',
  'gloriaolar',
  'artywink',
  'shadowmyst',
  'circlebubble',
  'zugs',
  'lisbethseijas',
  'evamillan',
  'world-travel-pro',
  'panconcajeta',
  'justclickindiva',
  'yeniluci',
  'franchalad',
  'amberkashif',
  'tfranzini',
  'jini-zzang',
  'boddhisattva',
  'faisalhanafih',
  'martinstomisin',
  'cjlugo',
  'emrysjobber',
  'nameless16',
  'yann03',
  'iamhafix',
  'edfer18',
  'alex-zen',
  'sunset.curator',
  'erikklok',
  'somu04',
  'abyssalsoul',
  'suhadi',
  'hispapro',
  'uthantzin',
  'elizabethbit',
  'baibuaza',
  'samest',
  'mariarodriguez',
  'rafaelaquino',
  'bozz',
  'josevillanueva',
  'hattaarshavin',
  'ninjacyber',
  'cwow2',
  'marcoquin',
  'melbourneswest',
  'kevinnag58',
  'preets',
  'photosnap',
  'huang-hsin',
  'kstop1',
  'chireerocks',
  'lebah',
  'pedrobrito2004',
  'josemalavem',
  'lorimusic',
  'actioncats',
  'tempertantric',
  'bitandi',
  'bobodan',
  'kinab',
  'drlobes',
  'inici-arte',
  'phuong.sitha',
  'selfhelp4trolls',
  'luisac',
  'hive-homeland',
  'hivegc',
  'mariaser',
  'mrnightmare.net',
  'paulfromkigali',
  'neuerko',
  'aino.tapani',
  'allonsyvilla',
  'tattoodjay',
  'garcondiable',
  'peaq',
  'marysenpai',
  'jimmy.adames',
  'pelon53',
  'pachamamakids',
  'emeka4',
  'antikus369',
  'wiseagent',
  'almi',
  'jetfrirod',
  'rahmadantara',
  'drabs587',
  'olaexcel',
  'papakciq',
  'enmy',
  'irisworld',
  'dimascastillo90',
  'jedenjenda',
  'hosgug',
  'hive-143869',
  'palomot',
  'heroldius',
  'belemo',
  'cetb2008',
  'adhammer',
  'yurche',
  'celeste413',
  'yameen',
  'denmarkguy',
  'maskuncoro',
  'beckybarbie98',
  'atongis',
  'globetrottergcc',
  'caciques',
  'alinalazareva',
  'laputis',
  'khiabels',
  'kingly0',
  'samostically',
  'veri-ardhian',
  'kaeraser',
  'sztorm',
  'sward',
  'elizacheng',
  'sabihaislam',
  'ashikstd',
  'maxwellmarcusart',
  'x-tech',
  'yo-hoho',
  'evegrace',
  'coolkris',
  'elgatoshawua',
  'maxer27',
  'valprincess',
  'jesusalejos',
  'kryptodenno',
  'nonsowrites',
  'karbea',
  'drhueso',
  'martusamak',
  'pixiepost',
  'shady',
  'nakary10',
  'barmbo',
  'malihasrk',
  'elikast',
  'eniolw',
  'cami16',
  'yuli07',
  'merlui03',
  'kawsar8035',
  'joseph1956',
  'cloudblade',
  'martinademora123',
  'franz54',
  'joheredia21',
  'wongi',
  'naidu24j',
  'blukei',
  'lebey1',
  'alicargofer',
  'aweee',
  'wwwiebe',
  'trayan',
  'jetn',
  'urun',
  'ibkdagreat',
  'rexmillerson',
  'sayalu',
  'davidthompson57',
  'gwenfinity',
  'arcange-de',
  'ldsklee',
  'irwanis',
  'jorgebgt',
  'emybaby',
  'guurry123',
  'alejandria12',
  'karlalares',
  'marlynale',
  'kaylinart',
  'aaliyahholt',
  'josueprime',
  'francysfiore',
  'dilimunanzar',
  'my451r',
  'costanza',
  'lightsplasher',
  'rahmot',
  'jordangerder',
  'kidsisters',
  'darmst5339',
  'damarisgm',
  'yolimarag',
  'artmom',
  'moisesrojas',
  'barbarabezina',
  'alejandrorigo',
  'tau-raghallach',
  'bityobit',
  'completewind',
  'zullyscott',
  'rokhani',
  'pouchon.tribes',
  'marieth',
  'mayorkeys',
  'funnel',
  'ilazramusic',
  'yanhan',
  'miriam11',
  'kriang3teejoe',
  'kohsamui99',
  'hive-data',
  'mcoinz79',
  'nerdvana',
  'notak',
  'estherscott',
  'cryptomaster5',
  'blackarer',
  'racheladeline',
  'daniky',
  'nathy33',
  'adetorrent',
  'sportscurator',
  'jfang003',
  'junierisme',
  'vezo',
  'kotenoke',
  'alechi',
  'arcange-fr',
  'zainalbakri',
  'sariyulis21',
  'morenatravels',
  'servelle',
  'footballpedia',
  'jasonmunapasee',
  'robinsonr810',
  'jepkupi',
  'buttonn',
  'abimbola753',
  'victoriabsb',
  'lighteye',
  'taillah',
  'mightyrocklee',
  'papilloncharity',
  'puza',
  'freidimar18',
  'monica-ene',
  'for91days',
  'lovesports',
  'evildeathcore',
  'drazeus',
  'artpetra',
  'esther-emmanuel',
  'tokenyzzy',
  'hiro-hive',
  'badmarriageidea',
  'eforucom',
  'numa26',
  'portalvotes',
  'oscarpower55',
  'maykit55',
  'txmek',
  'bonzopoe',
  'nuahs',
  'mrnightmare89',
  'hyperion-ezyro',
  'kirstin',
  'kushtia',
  'janyasai',
  'jorge234nv',
  'yris',
  'soulsdetour',
  'tdctunes',
  'cesar24',
  'yahialababidi',
  'ipolatjeh1988',
  'curly-xu',
  'bluefinstudios',
  'ffcrossculture',
  'davidcentenor',
  'stephyoung',
  'quin-art',
  'virgi2001',
  'lionsaturbix',
  'esteliopadilla',
  'tingjie',
  'luizeba',
  'forexbrokr',
  'jeennicious',
  'vimukthi',
  'winniekal',
  'jlufer',
  'inber',
  'viviana28',
  'khaleesii',
  'genice',
  'remiakther',
  'garamee21',
  'tomasjurado',
  'yeckingo1',
  'prtmtrta',
  'xplosive',
  'zottone444',
  'alexxedal',
  'otuyanancy',
  'joetunex',
  'fherdz',
  'steemmillionaire',
  'pablo1601',
  'solominer',
  'nweoomon',
  'dirkzett',
  'esmeesmith',
  'zamanh',
  'olivia08',
  'trojan1',
  'josselyn060',
  'davidbolu34',
  'teukuboyhaqie',
  'dorimar',
  'keys-defender',
  'ciudadcreativa',
  'steempower-001',
  'crazygal',
  'eimy7',
  'abundancelife',
  'dayatsiaulia',
  'lxsxl',
  'cristina-zac',
  'ezun1',
  'solaito',
  'musicandreview',
  'lasseehlers',
  'katic-19c',
  'merit.ahama',
  'browery',
  'tinman88',
  'smonkstop1',
  'burnoutawesome',
  'celf.magazine',
  'callmemaungthan',
  'a-quarius',
  'zpzn',
  'shinyobjects',
  'lingkar-photo',
  'dearw',
  'vaketo',
  'sgarciacine',
  'kachinhenry',
  'nandarlin',
  'igwee',
  'kellyane',
  'annas58',
  'dmilliz',
  'amberyooper',
  'bobokyaw',
  'marcusantoniu26',
  'weesleytv',
  'kelseyimoh',
  'aftabkhan10',
  'maria27',
  'salvao',
  'felt.buzz',
  'greciahello',
  'wadera',
  'antonio2270',
  'fansjuventusaceh',
  'improv',
  'name0',
  'duwiky',
  'rakhmatmargajaya',
  'fullcolorpy',
  'ygalue90',
  'jaxsonmurph',
  'claudio83',
  'dotwin1981',
  'ssygmr',
  'lichtblick',
  'theithei',
  'aurzeq',
  'mularh',
  'ecoinstant',
  'adamada',
  'emotionalsea',
  'josecarlos26',
  'sinlg',
  'thetimetravelerz',
  'awah',
  'benie111',
  'shula14',
  'doriana',
  'moeenali',
  'wrestlingdesires',
  'olgavita',
  'joseph23',
  'udabeu',
  'damoclesart',
  'blumela',
  'adalger',
  'sweettais',
  'aurodivys',
  'drunksamurai',
  'actifitsmart',
  'jrcenteno',
  'taskmaster4450le',
  'ph1102',
  'indirafernandez',
  'deltasteem',
  'chacald.dcymt',
  'jbtc19warrior',
  'amaterasusolar',
  'bencwarmer',
  'doudoer',
  'rucoin',
  'thisisawesome',
  'yessi08',
  'opopa',
  'bleuclair',
  'aiuna',
  'imfarhad',
  'sunray',
  'moistnuglet',
  'tedus',
  'taniagonzalez',
  'neilamarcano',
  'pouchon',
  'industriouslv2',
  'princeofbeyhive',
  'krazemetin',
  'wickiewike',
  'evev',
  'elizabeths14',
  'botefarm',
  'ace108',
  'atnep111',
  'palimanali',
  'jayoxaju',
  'mintymile',
  'eveyese1312',
  'matthew1',
  'gabrielatravels',
  'loboblanco',
  'robibasa',
  'definethedollar',
  'ana.rivas2104',
  'pinmapple',
  'buza-fz',
  'gurseerat',
  'ononiwujoel',
  'ocotuchodzi',
  'efrenramon',
  'artsofmarynowski',
  'mmckinneyphoto13',
  'azamrai',
  'ersa-siregar',
  'brasan',
  'mcgome',
  'dunstuff',
  'ayisah',
  'mercurial9',
  'alexa.art',
  'melissaparada',
  'cataluz',
  'idayrus',
  'hectorfaria1',
  'lizzy-b',
  'projectmamabg',
  'c3r34lk1ll3r',
  'smithlabs',
  'carlosehijos55',
  'filoriologo',
  'opeyemioguns',
  'shoutingmirror',
  'empress-eremmy',
  'princessbusayo',
  'cryptoandcoffee',
  'naradamoon',
  'hivesuperman',
  'yohaale',
  'walson3',
  'shahinaubl',
  'anthony2019',
  'mariaramirez',
  'libertycrypto27',
  'loot.vibes',
  'tejimundo',
  'lunaticanto',
  'mike.cupcakes',
  'toofasteddie',
  'ayrin344',
  'kaldewei',
  'mendozabrixio',
  'ciderjunkie',
  'valentinamc',
  'heskay',
  'nftshowroom',
  'jesuspsoto',
  'ablaze',
  'dante31',
  'paulmoon410',
  'desro',
  'alovely',
  'milanie',
  'flsfserkan',
  'eisha.shetty',
  'pardinus',
  'nyinyiwin',
  'theindiantrader',
  'sujiko',
  'chekohler',
  'realmankwon.scot',
  'itsmiessyonpeakd',
  'vicent21',
  'edwarlyn11',
  'florecitamejias',
  'miguelmederico',
  'saraidiaz',
  'oks2crypto',
  'friendlymoose',
  'iamjadeline',
  'fabianag',
  'frankvvv',
  'keilis',
  'teungkulik',
  'enjar',
  'bitcoinflood',
  'leandro85',
  'jeferybgomez',
  'splinterdany',
  'mehmetfix',
  'yousafharoonkhan',
  'nat.ortiz',
  'prolinuxua',
  'ph1102.ctp',
  'hornet-on-tour',
  'alenox',
  'practicaleric',
  'darth-azrael',
  'bettymorgan',
  'kemmyb',
  'faisalamin',
  'shikika',
  'ekotmordemy',
  'pheon',
  'mllg',
  'neoseven',
  'wolfofnostreet',
  'aishwarya',
  'brofund',
  'andrea.carolina',
  'sumaiya777',
  'mariavargas',
  'charcoalbuffet',
  'lupega',
  'anaboadas',
  'platypus-dundee',
  'olawalium',
  'mushanov',
  'bighungrypanda',
  'khrom',
  'anfood',
  'aerilia.auxilia',
  'hotsauceislethal',
  'nasrud',
  'albertocoachbl',
  'jedigeiss',
  'antoniarhuiz',
  'mersy',
  'rosatravels',
  'votee',
  'reeta0119',
  'okluvmee',
  'stefannikolov',
  'judithvlogs',
  'tajimkhan',
  'ewkaw',
  'cmmemes',
  'victorbz',
  'elsan.artes',
  'crystalmoon',
  'dedigobelz',
  'offgridlife',
  'coolguy123',
  'tobywalter',
  'divinationpod',
  'garzug',
  'eliezerdiaz21',
  'vasigo',
  'carolycesar15',
  'djynn',
  'tonyksart',
  'crownbee',
  'elenasteem',
  'igormuba',
  'wrsd54',
  'daniella619',
  'daniel2001',
  'preparedwombat',
  'louis88',
  'genesishealthy',
  'kuronokenshi',
  'welshstacker',
  'agustinaka',
  'ruskevych',
  'barry405',
  'monioluwa',
  'ford.stem',
  'steemstreems',
  'jhoancp',
  'zhangyan-123',
  'mein-senf-dazu',
  'gric',
  'an-man',
  'chloe.citation',
  'python13',
  'ykretz',
  'happyme',
  'boddhistats',
  'maylenasland',
  'kansuze',
  'justtalking',
  'andreaag21',
  'satren',
  'esecholo',
  'angelrey199026',
  'hernleon74',
  'alba-rosaced',
  'numpypython',
  'shirahoshi',
  'sergioluisbr08',
  'news2share',
  'taskmaster4450',
  'cryptofi',
  'sitinurfauziyyah',
  'digitalopus',
  'delvallecedeno',
  'nave7',
  'akhyar23',
  'cypherfox',
  'eleez',
  'lolysacc',
  'anicom',
  'carolkean',
  'popurri',
  'slobberchops',
  'yajamire',
  'joceelyn',
  'certain',
  'joshsticks28',
  'yole',
  'kennyroy',
  'cami.rojas',
  'arunava',
  'mayorfaruk',
  'nostalgic1212',
  'mayvileros',
  'javyeslava.photo',
  'ahmdorak',
  'carmensalinas',
  'mysteryreader',
  'harulovesanime',
  'tonero',
  'susie-saver',
  'atnazo',
  'geadriana',
  'sanjeev021',
  'padom2020',
  'sofathana',
  'leomontagg',
  'ppics',
  'd-rock',
  'utymarvel',
  'zeruxanime',
  'article61',
  'mayorbee',
  'maarnio',
  'walterprofe',
  'mproxima',
  'trumpman',
  'lucianav',
  'alarconzeu',
  'egonz',
  'peckypeace',
  'rentmoney',
  'salvadornkpara',
  'darth-cryptic',
  'miroslavrc',
  'helengutier2',
  'ruth-girl',
  'maisugar',
  'projectmama',
  'andestethic',
  'aurimar20',
  'namelessnameless',
  'devyleona',
  'jaraumoses',
  'dragokazo',
  'krazeacc',
  'cabinet24',
  'vesytz',
  'littlegremlin',
  'phillarecette',
  'travelfeed',
  'noreensajawal6',
  'krusty81',
  'aiovo',
  'desirejp91',
  'yogeshbhatt',
  'whynotcamp',
  'israel.art',
  'edgerik',
  'marblely',
  'wendyth16',
  'millycf1976',
  'peterale',
  'gidlark',
  'nyimwa',
  'ecoinstats',
  'erikah',
  'agimat',
  'knowhow92',
  'elcrack',
  'bruno-kema',
  'iamchuks',
  'krakonos',
  'genesis30',
  'malomi',
  'bhattg',
  'mistural',
  'tezzmax',
  'stanestyle',
  'kolkamkwan',
  'antonellasc',
  'hodlcommunity',
  'assasin',
  'mrarhat',
  'lisamgentile1961',
  'yonniel24',
  'abduhawab',
  'yiobri',
  'alejandroaldana',
  'chrono.spt',
  'felixgarciap',
  'fachrulreza',
  'mariya36',
  'mara116',
  'mimi05',
  'saviib',
  'theresa16',
  'teerawith',
  'myothuzar',
  'mad-runner',
  'millymillions',
  'joseannyt',
  'rufans',
  'pekab',
  'thehockeyfan-at',
  'pjansen',
  'rigel-gladys',
  'fermentedphil',
  'ojbright',
  'jjprac',
  'codingdefined',
  'kevmcc',
  'marivic10',
  'izzieperez',
  'katirayo',
  'monochromes',
  'abisag',
  'janettbrito76',
  'beth78',
  'gorayii',
  'bdmillergallery',
  'realmankwon',
  'luminaryhmo',
  'xabi',
  'drugelis',
  'viviankay00',
  'sarahdavis',
  'davidpena21',
  'prayzz',
  'amryksr',
  'alfrednoyed',
  'der-prophet',
  'titti',
  'soehada',
  'yilibeth',
  'mafalda2018',
  'equipodelta',
  'freemonster',
  'tradingideas.spt',
  'mflegerbein',
  'khaleelkazi',
  'yefete',
  'bossel',
  'bob-dray',
  'adonisr',
  'jauregui98',
  'vlemon',
  'littledisciples',
  'rxhector',
  'drrune',
  'paolazun',
  'soufianechakrouf',
  'angie2003',
  'kosikredki',
  'rezoanulvibes',
  'marytierra',
  'rarej',
  'coliva',
  'seckorama',
  'zedikaredirect',
  'marco77290',
  'carlitazulay',
  'hive-151070',
  'ileart',
  'trincowski',
  'shirleynpenalosa',
  'suzn.poudel',
  'jorgevandeperre',
  'slackerman',
  'loveisintheair',
  'jlvillamizar',
  'chorock',
  'perceval',
  'ekushya',
  'exhaust',
  'ovey10',
  'josegilberto',
  'camilar',
  'scottshots',
  'skyple',
  'brujita18',
  'naty16',
  'uyobong',
  'hive-127788',
  'daysiselena',
  'mijan11',
  'akdx',
  'rutablockchain',
  'suezoe',
  'geraldhm',
  'pele23',
  'qsyal',
  'daltono',
  'edenparadise',
  'gracious21',
  'sponge-bob',
  'specialfeelings',
  'sharpshot',
  'andr3apat1no',
  'maryoris.marcano',
  'anggreklestari',
  'globalcurrencies',
  'discohedge',
  'babsgirl',
  'cryptomaniacsgr',
  'cheva',
  'arpamorocho',
  'nelinoeva',
  'freddyma',
  'whiteangey',
  'yogajill',
  'danny.green',
  'any94',
  'norelysgp',
  'princessj190',
  'presidentx',
  'old-guy-photos',
  'badbitch',
  'rupabandhu',
  'alexvan',
  'scubahead',
  'ddn688',
  'kahkashan',
  'debbie-ese',
  'aagabriel',
  'curart38',
  'jemima1996',
  'hersi007',
  'dwixer',
  'bucipuci',
  'bluemoon',
  'jgb',
  'rizzellofabio',
  'rosiew',
  'l337m45732',
  'josuemonterola',
  'ali-raza',
  'agreste',
  'newton666',
  'organduo',
  'marcosnin',
  'jocluis77',
  'universoperdido',
  'manuel2395',
  'sassycebuana',
  'dfacademy',
  'asia-pl',
  'mavis16',
  'fa-him',
  'aularjavier',
  'ua-promoter',
  'hamanni',
  'lyann',
  'sk1920',
  'ezuntimmy',
  'abogcoronado',
  'manuvert',
  'ediyelly',
  'fatherfaith',
  'eveuncovered',
  'jurich60',
  'detlev',
  'kathy03',
  'd-company',
  'ssekulji',
  'rainingfall',
  'fotorincon12',
  'fabian98',
  'mmykel',
  'wineyoudyer',
  'jodipamungkas',
  'miguelaag',
  'iamraincrystal',
  'lanzjoseg',
  'theoctoberwind',
  'vibhagupta',
  'tfame3865',
  'mariannewest',
  'kaminchan',
  'alive.chat',
  'rachelcreative',
  'ericburgoyne',
  'bdfoods',
  'maonx',
  'ellenripley',
  'fionoalejo',
  'mariela-b',
  'synrg',
  'jay-one',
  'elmundodexao',
  'juecoree',
  'rs405',
  'zeero22',
  'zyx066',
  'xgerard',
  'winniex',
  'lasman07',
  'bambuka',
  'andrearojas55',
  'casperbgd',
  'contrabourdon',
  'simaroy',
  'fredkese',
  'tonytrillions',
  'oldmans',
  'isdarmady',
  'cool08',
  'ezunjoshy',
  'banzafahra',
  'apnigrich',
  'yahia-lababidi',
  'ninahaskin',
  'thurawinkyaw',
  'sarimanok',
  'alfarero',
  'artysteps',
  'mariperez316',
  'amandaj',
  'jaydr',
  'pankajkabdwal',
  'marifar',
  'indelvalle65',
  'labeba1969',
  'sultan-indo',
  'quinnertronics',
  'estefania3',
  'marybellrg',
  'ryivhnn',
  'surglen',
  'bsas',
  'davidbright',
  'belkisa758',
  'toushik',
  'edicted',
  'slwzl',
];

@Injectable()
export class TasksService {
  private expirePostClient;
  private readonly logger = new Logger(TasksService.name);

  constructor(
    private readonly postService: PostsService,
    private readonly redisService: RedisService,
    private readonly hiveMindService: HiveMindService,
    private readonly hiveEngineService: HiveEngineService,
    private readonly userService: UserService,
  ) {
    this.expirePostClient = this.redisService.getClient(REDIS_EXPIRE_CLIENT);
  }

  @Cron('05 */1 * * *')
  async updateVotesOnPost(): Promise<void> {
    const hourAgo = moment.utc().subtract(1, 'hour').startOf('hour').format();
    const posts = await this.expirePostClient.smembers(`${REDIS_KEY_VOTE_UPDATES}:${hourAgo}`);
    if (_.isEmpty(posts)) return;

    for (const post of posts) {
      const [author, permlink] = post.split('/');
      const postInDb = await this.postService.findOneByRootAuthorPermlink(author, permlink);
      if (!postInDb) continue;
      const postForUpdate = await this.hiveMindService.getPost(author, permlink);
      if (!postForUpdate) continue;

      postForUpdate.author = postInDb.author;
      postForUpdate.active_votes = _.reduce(postForUpdate.active_votes, (acc, item) => {
        acc.push({
          ..._
            .chain(item)
            .merge(_.pick(
              _.find(postInDb.active_votes, { voter: item.voter }),
              ['rsharesWAIV'],
            ))
            .pick(VOTE_FIELDS)
            .value(),
          weight: Math.round(item.rshares * 1e-6),
        });
        return acc;
      },
      []);
      _.forEach(postInDb.active_votes, (dbVote) => {
        if (dbVote.voter.includes('_')) {
          postForUpdate.active_votes.push(dbVote);
        }
      });
      const res = await this.postService.updateOneByRoot(postForUpdate);
      if (res.modifiedCount) this.logger.log(`Votes on @${author}/${permlink} updated!`);
    }
    await this.expirePostClient.del(`${REDIS_KEY_VOTE_UPDATES}:${hourAgo}`);
  }

  @Cron('20 */1 * * *')
  async updateChildrenOnPost(): Promise<void> {
    const hourAgo = moment.utc().subtract(1, 'hour').startOf('hour').format();
    const records = await this.expirePostClient.smembers(`${REDIS_KEY_CHILDREN_UPDATE}:${hourAgo}`);
    if (_.isEmpty(records)) return;

    for (const record of records) {
      const [author, permlink] = record.split('/');
      const comment = await this.hiveMindService.getPost(author, permlink);
      if (!comment || !comment.root_author) continue;
      const post = await this.hiveMindService.getPost(comment.root_author, comment.root_permlink);
      if (!post || !post.author) continue;
      const res = await this.postService
        .updateOneByRoot(_.pick(post, ['root_author', 'permlink', 'children']));
      if (res.modifiedCount) this.logger.log(`Children on @${post.root_author}/${post.permlink} updated!`);
    }
    await this.expirePostClient.del(`${REDIS_KEY_CHILDREN_UPDATE}:${hourAgo}`);
  }

  @Cron('*/2 * * * * *')
  async voteOnHiveEnginePosts(): Promise<void> {
    const threeDaysAgo = moment.utc().subtract(3, 'days').startOf('day').format();
    const postsKey = `${REDIS_KEY_DISTRIBUTE_HIVE_ENGINE_REWARD}:${HIVE_ENGINE_TOKENS.WAIV}:${threeDaysAgo}`;
    const rewardedKey = `${REDIS_KEY_REWARDED_AUTHORS}:${HIVE_ENGINE_TOKENS.WAIV}`;

    const records = await this.expirePostClient.smembers(postsKey);
    const rewarded = await this.expirePostClient.smembers(rewardedKey);
    if (_.isEmpty(records)) return;

    const postsList = _.reduce(records, (acc, el) => {
      const [author, permlink] = el.split('/');
      if (!_.includes(rewarded, author)) acc.push({ author, permlink });
      return acc;
    }, []);
    if (_.isEmpty(postsList)) return;

    // #TODO need pool id
    const globalProperties = await this.hiveMindService.getDynamicGlobalProperties();
    const currentPrice = await this.hiveMindService.getCurrentPriceInfo();
    const rewards = parseFloat(globalProperties.reward_balance) / parseFloat(globalProperties.recent_claims);
    const price = parseFloat(currentPrice.base) / parseFloat(currentPrice.quote);
    // const rewards = parseFloat(rewardPool) / parseFloat(pendingClaims);
    // expertise to filter reward lte 50$
    const expertiseFiler = (50 / (rewards * price)) / 1000000;
    const users1 = await this.userService.find(
      { name: { $in: users }, wobjects_weight: { $lte: expertiseFiler } },
      { wobjects_weight: 1, name: 1 },
    );
    const filteredAuthors = _.filter(postsList, (el) => _.includes(_.map(users, 'name'), el.author));
    if (_.isEmpty(filteredAuthors)) return;

    console.log();
  }
}
